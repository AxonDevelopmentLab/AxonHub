let CACHE={ProcessID:"",plan:"",price:0,duration:1,payment_method:"PIX",promotional_code:"",promotional_discount:0,payment_code:""},PLAN_PRICE=document.getElementById("plan.price"),DISCOUT_VALUE=document.getElementById("discount.value"),SUBTOTAL_PRICE=document.getElementById("subtotal.price"),DISCOUNT_INPUT=document.getElementById("discount.input");if(localStorage.getItem("auth_token"))if(localStorage.getItem("shopping.cart")){let GETPLAN=localStorage.getItem("shopping.cart");localStorage.removeItem("shopping.cart"),selectPlan(GETPLAN),document.getElementById("checkout.request").style.display="block"}else redirect("store");else redirect("account?changetype=true&redirectTo=https://axonhub.glitch.me/store/checkout");function selectPlan(PlanName){var plans={axonplus:14.99};if(!Object.keys(plans).includes(PlanName))return selectPlan("axonplus");document.getElementById("plan.duration").value="1",document.getElementById("plans.list").value=PlanName,CACHE.plan=PlanName,CACHE.price=plans[PlanName],subtotalCalculator()}$.post("https://axon-api.glitch.me/account/get",{token:localStorage.getItem("auth_token"),services:["account"]}).done(function(data){document.getElementById("account.email").value=data.services.account.email}).fail(function(failed){redirect("store")});let DurationElement=document.getElementById("plan.duration"),PlansElement=(DurationElement.addEventListener("change",function(){var DurationValue=DurationElement.options[DurationElement.selectedIndex].value;CACHE.duration=Number(DurationValue),subtotalCalculator()}),document.getElementById("plans.list"));function subtotalCalculator(){PLAN_PRICE.innerHTML=`R$ ${CACHE.price} × ${CACHE.duration} (Meses)`;let SUBTOTAL=CACHE.price*CACHE.duration,DiscountText="";0!==CACHE.promotional_discount&&(DISCOUT_VALUE.innerHTML=`Desconto de <b>${CACHE.promotional_discount}%</b> aplicado.`,DiscountText=" <b>Com Desconto</b>",SUBTOTAL=SUBTOTAL/100*(100-CACHE.promotional_discount));var SUBTOTAL_Text="R$ "+SUBTOTAL.toFixed(2)+DiscountText;SUBTOTAL_PRICE.innerHTML=SUBTOTAL_Text}function endCheckout(){var GenerateBuyRequest={token:localStorage.getItem("auth_token"),plan:CACHE.plan,duration:CACHE.duration,payment_method:CACHE.payment_method,discount:CACHE.promotional_code};$.post("https://axon-api.glitch.me/store/checkout/create",GenerateBuyRequest).done(function(data){if(400===data.status)return alert(data.message),redirect("/");200===data.status&&(CACHE.ProcessID=data.processid,document.getElementById("qrcode.img").src="data:image/png;base64,"+data.payment.qrcode,CACHE.payment_code=data.payment.code,checkPaymentStatus())}).fail(function(failed){return alert("Não foi possível finalizar a sua compra, entre em contato com o suporte.")});let i=0,awaitingForPayment=setInterval(()=>{document.getElementById("checkout.pay").style.display?(4==++i&&(i=0),document.getElementById("awaiting.payment").innerHTML="Aguardando pagamento"+".".repeat(i)):clearInterval(awaitingForPayment)},650);document.getElementById("checkout.request").style.display="none",document.getElementById("checkout.pay").style.display="block"}function checkPaymentStatus(){let loop=setInterval(()=>{$.post("https://axon-api.glitch.me/store/checkout/status",{token:localStorage.getItem("auth_token"),processid:CACHE.ProcessID}).done(function(data){if(403===data.status)return alert("Não foi possível localizar o seu pedido no banco de dados. Envie o seu comprovante de pagamento para o suporte realizar o processo de reembolso.");200===data.status&&(clearInterval(loop),document.getElementById("sucess.planname").innerHTML=data.planname,paymentApproved())}).fail(function(failed){return alert("Não foi possível localizar o seu pedido no banco de dados. Envie o seu comprovante de pagamento para o suporte realizar o processo de reembolso.")})},1e4)}function copyPixKey(){navigator.clipboard.writeText(CACHE.payment_code).then(()=>{alert("A Chave PIX foi copiada com sucesso.")}).catch(err=>{alert("Ocorreu um erro ao copiar a Chave PIX.")})}function paymentApproved(){document.getElementById("checkout.pay").style.display="none",document.getElementById("checkout.sucess").style.display="block"}PlansElement.addEventListener("change",function(){selectPlan(PlansElement.options[PlansElement.selectedIndex].value)}),DISCOUNT_INPUT.addEventListener("keydown",e=>{"Enter"===e.key&&(DISCOUNT_INPUT.disabled=!0,$.post("https://axon-api.glitch.me/store/checkout/discount",{discount:DISCOUNT_INPUT.value}).done(function(data){if(400===data.status)return DISCOUNT_INPUT.disabled=!1,alert("Código promocional inválido.");200===data.status&&(alert("Código promocional aplicado com sucesso."),CACHE.promotional_code=DISCOUNT_INPUT.value,CACHE.promotional_discount=data.discount,subtotalCalculator())}).fail(function(failed){return DISCOUNT_INPUT.disabled=!1,alert("Não foi possível aplicar o desconto.")}),e.preventDefault())});